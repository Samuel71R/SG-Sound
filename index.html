<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG SOUND SERVE | Enterprise Portal</title>
    <link rel="icon" type="image/png" href="logo2.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        /* --- CORPORATE THEME --- */
        :root {
            --bg-dark: #0f172a; 
            --bg-panel: #1e293b; 
            --accent-gold: #fbbf24; 
            --accent-blue: #3b82f6; 
            --text-main: #f1f5f9; 
            --text-muted: #94a3b8; 
            --border: 1px solid rgba(255, 255, 255, 0.1); 
            --shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background-color: var(--bg-dark); color: var(--text-main); overflow-x: hidden; }
        .hidden { display: none !important; }
        
        .btn { padding: 12px 25px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 0.95rem; }
        .btn-gold { background: var(--accent-gold); color: #0f172a; }
        .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(251, 191, 36, 0.3); }
        .btn-outline { background: transparent; border: 1px solid var(--accent-gold); color: var(--accent-gold); }
        .btn-outline:hover { background: var(--accent-gold); color: #0f172a; }

        /* --- BACKGROUND IMAGE FOR DASHBOARD --- */
        #main-app {
            background-image: url('photo-1514525253161-7a46d19cd819.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            position: relative;
            min-height: 100vh;
        }
        #main-app::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.90);
            z-index: 0;
        }
        .navbar, .dashboard-container {
            position: relative;
            z-index: 1;
        }

        /* --- LANDING PAGE STYLES --- */
        #landing-page { min-height: 100vh; display: flex; flex-wrap: wrap; }
        .brand-section { flex: 1.2; position: relative; overflow: hidden; display: flex; flex-direction: column; justify-content: center; padding: 80px; min-width: 350px; }
        
        .slideshow { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; }
        .slide-item { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; opacity: 0; animation: slideAnimation 18s infinite; }
        .slide-1 { background-image: url('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?q=80&w=2070&auto=format&fit=crop'); animation-delay: 0s; }
        .slide-2 { background-image: url('https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?q=80&w=2070&auto=format&fit=crop'); animation-delay: 6s; }
        .slide-3 { background-image: url('https://images.unsplash.com/photo-1598387993441-a364f854c3e1?q=80&w=2076&auto=format&fit=crop'); animation-delay: 12s; }
        @keyframes slideAnimation { 0% { opacity: 0; transform: scale(1); } 5% { opacity: 1; } 33% { opacity: 1; } 38% { opacity: 0; transform: scale(1.1); } 100% { opacity: 0; } }
        
        .brand-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(15, 23, 42, 0.7) 100%); z-index: 1; }
        .brand-content { position: relative; z-index: 2; }
        .brand-title { font-size: 4.5rem; font-weight: 800; line-height: 1; margin-bottom: 20px; letter-spacing: -2px; text-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .brand-title span { color: var(--accent-gold); }
        .brand-subtitle { font-size: 1.2rem; color: #e2e8f0; max-width: 500px; line-height: 1.6; border-left: 4px solid var(--accent-gold); padding-left: 20px; }
        
        .login-section { 
            flex: 0.8; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            background: var(--bg-dark); 
            flex-direction: column; 
            padding: 40px; 
            min-width: 320px; 
            border-left: 1px solid rgba(255,255,255,0.05);
            position: relative;
        }

        .login-logo {
            position: absolute;
            top: 5px;
            right: 18px;
            width: 110px; 
            height: auto;
            display: block;
            object-fit: contain;
            transition: transform 0.4s ease;
            z-index: 10;
        }
        .login-logo:hover { transform: scale(1.05); }

        .auth-card { width: 100%; max-width: 400px; padding: 40px; background: var(--bg-panel); border-radius: 16px; box-shadow: var(--shadow); border: var(--border); }
        .auth-tabs { display: flex; margin-bottom: 20px; border-bottom: var(--border); }
        .auth-tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; color: var(--text-muted); transition: 0.3s; }
        .auth-tab.active { color: var(--accent-gold); border-bottom: 2px solid var(--accent-gold); font-weight: bold; }
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; margin-bottom: 8px; color: var(--text-muted); font-size: 0.9rem; }
        .input-group input, .input-group textarea, .input-group select { width: 100%; padding: 12px; background: var(--bg-dark); border: var(--border); border-radius: 6px; color: white; outline: none; transition: 0.3s; }
        .forgot-link { display: block; text-align: right; font-size: 0.8rem; color: var(--accent-blue); margin-top: -10px; margin-bottom: 15px; cursor: pointer; text-decoration: none; }
        
        /* NAVBAR & DASHBOARD */
        .navbar { height: auto; min-height: 80px; border-bottom: var(--border); display: flex; flex-wrap: wrap; justify-content: space-between; align-items: center; padding: 10px 40px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; }
        .nav-menu { display: flex; gap: 20px; flex-wrap: wrap; margin: 10px 0; }
        .nav-item { color: var(--text-muted); cursor: pointer; font-weight: 500; white-space: nowrap; padding-bottom: 5px; border-bottom: 2px solid transparent; transition: 0.3s; }
        .nav-item:hover { color: var(--accent-gold); }
        .nav-item.active { color: var(--accent-gold); border-bottom: 2px solid var(--accent-gold); }
        .cart-badge { background: var(--accent-blue); padding: 2px 6px; border-radius: 10px; font-size: 0.7rem; font-weight: bold; position: relative; top: -10px; left: -5px; }

        .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; width: 100%; animation: fadeIn 0.6s ease; }
        .welcome-banner { background: linear-gradient(135deg, var(--bg-panel), #1e1b4b); padding: 40px; border-radius: 16px; border: var(--border); margin-bottom: 30px; }
        
        /* DATE PICKER BANNER */
        .date-picker-banner {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            padding: 30px;
            border-radius: 16px;
            border: 1px solid var(--accent-gold);
            margin-bottom: 40px;
            text-align: center;
        }
        .date-picker-banner h3 {
            color: var(--accent-gold);
            margin-bottom: 15px;
            font-size: 1.4rem;
        }
        .date-picker-banner input[type="date"] {
            padding: 12px 20px;
            background: var(--bg-dark);
            border: var(--border);
            color: white;
            border-radius: 8px;
            font-size: 1rem;
            margin-right: 15px;
        }
        .availability-status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 8px;
            font-weight: 600;
        }
        .availability-status.success {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid #22c55e;
        }
        .availability-status.warning {
            background: rgba(251, 191, 36, 0.2);
            color: var(--accent-gold);
            border: 1px solid var(--accent-gold);
        }
        
        .section-title {
            text-align: center;
            font-size: 1.1rem;
            letter-spacing: 3px;
            text-transform: uppercase;
            color: var(--accent-gold);
            margin: 60px 0 20px 0;
            font-weight: 700;
            position: relative;
            display: inline-block;
            width: 100%;
        }
        .section-title::after {
            content: '';
            display: block;
            width: 50px;
            height: 3px;
            background: var(--accent-gold);
            margin: 10px auto 0 auto;
            border-radius: 2px;
        }

        /* CARD SWAP (GSAP) */
        .card-swap-wrapper {
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 50px;
            position: relative;
            perspective: 1000px;
        }
        .swap-container { width: 320px; height: 240px; position: relative; }
        .swap-card {
            position: absolute; width: 100%; height: 100%; border-radius: 20px;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            border: 1px solid rgba(251, 191, 36, 0.3);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            box-shadow: 0 20px 50px -10px rgba(0, 0, 0, 0.8); padding: 25px;
            text-align: center; transform-origin: center center; overflow: hidden;
        }
        .swap-card h3 { color: white; margin-bottom: 8px; font-size: 1.6rem; font-weight: 700; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
        .swap-card p { color: var(--text-muted); font-size: 0.95rem; line-height: 1.5; }
        .swap-card .highlight-tag { 
            position: absolute; top: 20px; right: 20px; 
            background: var(--accent-gold); color: #0f172a; 
            padding: 5px 12px; border-radius: 30px; font-size: 0.75rem; font-weight: 800; 
            text-transform: uppercase; box-shadow: 0 5px 15px rgba(251, 191, 36, 0.4);
        }

        /* FLOWING MENU */
        .flowing-menu-section {
            margin-bottom: 60px; position: relative; height: 350px; overflow: hidden;
            border-radius: 24px; border: 1px solid rgba(255,255,255,0.1);
            background: #0f172a; box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        .flowing-bg-image {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center; opacity: 0.6;
            transition: background-image 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 0;
        }
        .flowing-bg-image::after {
            content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(90deg, rgba(15,23,42,0.95) 0%, rgba(15,23,42,0.7) 50%, rgba(15,23,42,0.4) 100%);
        }
        .flowing-list {
            position: relative; z-index: 1; display: flex; flex-direction: column;
            justify-content: center; height: 100%; padding: 0 60px; gap: 15px;
        }
        .flowing-item {
            font-size: 3rem; font-weight: 900; text-transform: uppercase; cursor: pointer;
            transition: all 0.4s ease; line-height: 1.1; color: transparent;
            -webkit-text-stroke: 1px rgba(255, 255, 255, 0.3);
        }
        .flowing-item:hover {
            color: var(--accent-gold); -webkit-text-stroke: 0; padding-left: 30px;
            text-shadow: 0 0 30px rgba(251, 191, 36, 0.6);
        }

        /* STANDARD GRIDS */
        .portals-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; }
        .portal-card { 
            background: var(--bg-panel); border: var(--border); border-radius: 16px; overflow: hidden; height: 250px; 
            position: relative; cursor: pointer; transition: 0.3s; background-size: cover; background-position: center;
        }
        .portal-card:hover { transform: translateY(-5px); border-color: var(--accent-gold); box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .card-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, rgba(15, 23, 42, 0.95), rgba(15, 23, 42, 0.3)); z-index: 1; }
        .card-content { position: absolute; bottom: 25px; left: 25px; z-index: 2; }
        .card-title { font-size: 1.8rem; font-weight: 700; color: white; margin-bottom: 5px; }
        .card-subtitle { color: var(--accent-gold); font-size: 0.95rem; font-weight: 500; text-transform: uppercase; letter-spacing: 1px; }

        /* PRODUCT CARD */
        .product-card { 
            background: var(--bg-panel); border: var(--border); border-radius: 12px; padding: 20px; position: relative; 
            display: flex; flex-direction: column;
        }
        .product-img { width: 100%; height: 180px; object-fit: cover; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1); }
        
        /* NEW: Sample Media Button */
        .sample-media-btn {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(251, 191, 36, 0.2);
            border: 1px solid var(--accent-gold);
            color: var(--accent-gold);
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            transition: 0.3s;
            margin-top: 10px;
        }
        .sample-media-btn:hover {
            background: var(--accent-gold);
            color: #0f172a;
        }
        .sample-media-btn i {
            margin-right: 5px;
        }
        
        /* CATALOGUE */
        .catalog-layout { display: flex; gap: 20px; flex-wrap: wrap; }
        .catalog-sidebar { width: 250px; background: var(--bg-panel); padding: 20px; border-radius: 12px; height: fit-content; }
        .catalog-filter { padding: 10px; cursor: pointer; border-radius: 6px; margin-bottom: 5px; color: var(--text-muted); }
        .catalog-filter.active { background: var(--accent-gold); color: black; font-weight: bold; }
        .catalog-items { flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }

        /* CONNECT */
        .connect-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 40px; }
        .shop-detail-card { 
            background: rgba(30, 41, 59, 0.6); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); 
            border-radius: 20px; padding: 40px; box-shadow: 0 15px 35px rgba(0,0,0,0.3); transition: 0.3s;
        }
        .shop-detail-card:hover { border-color: rgba(251, 191, 36, 0.3); }
        .info-row { display: flex; gap: 20px; margin-bottom: 25px; align-items: flex-start; }
        .info-icon { 
            width: 50px; height: 50px; background: linear-gradient(135deg, rgba(251, 191, 36, 0.2), rgba(251, 191, 36, 0.05)); 
            color: var(--accent-gold); border-radius: 12px; display: flex; align-items: center; justify-content: center; 
            font-size: 1.2rem; border: 1px solid rgba(251, 191, 36, 0.2); flex-shrink: 0;
        }
        .social-card { 
            display: flex; align-items: center; gap: 20px; padding: 18px 25px; border-radius: 12px; 
            background: rgba(255, 255, 255, 0.03); border: 1px solid rgba(255, 255, 255, 0.05); 
            text-decoration: none; color: white; font-weight: 500; transition: all 0.3s ease; margin-bottom: 15px;
        }
        .social-card:hover { background: rgba(255, 255, 255, 0.08); transform: translateX(5px); border-color: var(--accent-gold); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .social-card i { font-size: 1.4rem; width: 30px; text-align: center; transition: 0.3s; }
        .social-card:hover .fa-instagram { color: #d62976; text-shadow: 0 0 10px rgba(214, 41, 118, 0.5); }
        .social-card:hover .fa-whatsapp { color: #25D366; text-shadow: 0 0 10px rgba(37, 211, 102, 0.5); }
        .social-card:hover .fa-youtube { color: #FF0000; text-shadow: 0 0 10px rgba(255, 0, 0, 0.5); }
        .social-card:hover .fa-map { color: #4285F4; text-shadow: 0 0 10px rgba(66, 133, 244, 0.5); }

        /* GALLERY STYLES - ENHANCED WITH MEDIA SUPPORT */
        .gallery-hero { 
            width: 100%; height: 400px; 
            background-image: url('https://images.unsplash.com/photo-1571266028243-371695039989?q=80&w=2070&auto=format&fit=crop'); 
            background-size: cover; background-position: center; 
            position: relative; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; 
            margin-bottom: 50px; border-radius: 0 0 16px 16px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .gallery-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(15, 23, 42, 0.7); z-index: 1; }
        .gallery-hero-content { position: relative; z-index: 2; text-align: center; }
        .gallery-main-title { font-size: 4rem; font-weight: 900; letter-spacing: -2px; }
        .gallery-nav-bar { display: flex; gap: 25px; margin-top: 20px; justify-content: center; flex-wrap: wrap; }
        .gallery-nav-link { color: var(--text-muted); cursor: pointer; transition: 0.3s; font-weight: 500; }
        .gallery-nav-link:hover { color: var(--accent-gold); }
        .gallery-section-header { font-size: 2.5rem; margin-bottom: 40px; font-weight: 800; }
        .gallery-split-layout { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); 
            gap: 30px; 
            margin-bottom: 40px;
            width: 100%;
            max-width: 100%;
            overflow: hidden;
        }
        
        .gallery-display-item {
            background: var(--bg-panel);
            border: var(--border);
            border-radius: 16px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: 0.3s;
            max-width: 100%;
            contain: layout style paint;
        }
        .gallery-display-item:hover {
            transform: translateY(-5px);
            border-color: var(--accent-gold);
            box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }
        .gallery-img-wrapper {
            width: 100%;
            height: 300px;
            overflow: hidden;
            position: relative;
        }
        .gallery-img-wrapper img, .gallery-img-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            transform: translateZ(0);
        }
        .gallery-display-item:hover .gallery-img-wrapper img,
        .gallery-display-item:hover .gallery-img-wrapper video {
            transform: scale(1.05);
        }
        .gallery-item-label {
            padding: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }
        .gallery-item-sub {
            padding: 0 20px 20px 20px;
            color: var(--text-muted);
            font-size: 0.95rem;
        }
        
        /* Media Play Overlay */
        .media-play-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70px;
            height: 70px;
            background: rgba(251, 191, 36, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0f172a;
            font-size: 2rem;
            z-index: 2;
            transition: 0.3s;
            opacity: 0;
        }
        .gallery-display-item:hover .media-play-overlay {
            opacity: 1;
        }
        
        /* ABOUT */
        .category-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
        .about-header { font-size: 3rem; font-weight: 900; margin-bottom: 30px; line-height: 1.2; }
        .about-content { font-size: 1.1rem; line-height: 1.8; color: var(--text-muted); max-width: 800px; }
        .about-list { margin-top: 30px; list-style: none; display: flex; gap: 20px; flex-wrap: wrap; }
        .about-list li { background: var(--bg-panel); padding: 15px 25px; border-radius: 8px; border-left: 4px solid var(--accent-gold); font-weight: 600; }
        .about-image-container { width: 100%; max-width: 800px; margin: 0 auto 50px auto; border-radius: 16px; overflow: hidden; border: var(--border); }
        .about-image { width: 100%; height: auto; display: block; }
        .about-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 40px; margin-top: 40px; }
        .about-card h3 { font-size: 1.8rem; font-weight: 700; margin-bottom: 15px; color: white; }
        .about-card p { color: var(--text-muted); line-height: 1.6; }

        /* MODALS */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 1000; display: flex; justify-content: center; align-items: center; }
        .modal-box { background: var(--bg-panel); width: 90%; max-width: 600px; padding: 30px; border-radius: 16px; border: 1px solid var(--accent-gold); max-height: 90vh; overflow-y: auto; }
        .invoice-paper { background: white; color: #111; padding: 20px; font-family: 'Helvetica', sans-serif; border-radius: 4px; }
        .bill-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .bill-table th, .bill-table td { padding: 10px; border-bottom: 1px solid #ddd; text-align: left; }

        @media (max-width: 768px) {
            .brand-title { font-size: 3rem; }
            .navbar { padding: 10px 20px; flex-direction: column; align-items: stretch; }
            .nav-menu { justify-content: center; gap: 15px; overflow-x: auto; padding-bottom: 10px; }
            .catalog-layout { flex-direction: column; }
            .catalog-sidebar { width: 100%; display: flex; overflow-x: auto; gap: 10px; }
            .about-header { font-size: 2rem; text-align: center; }
            .brand-section { padding: 40px 20px; text-align: center; }
            .brand-subtitle { margin: 0 auto; border-left: none; padding-left: 0; border-top: 4px solid var(--accent-gold); padding-top: 10px; }
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <section id="landing-page">
        <div class="brand-section">
            <div class="slideshow">
                <div class="slide-item slide-1"></div>
                <div class="slide-item slide-2"></div>
                <div class="slide-item slide-3"></div>
            </div>
            <div class="brand-overlay"></div>
            <div class="brand-content">
                <h1 class="brand-title">SG <span>SOUND</span><br>SERVE</h1>
                <p class="brand-subtitle">The Enterprise Standard for Professional Audio, Rentals, and Event Production. <b>Sales & Service Excellence for 20+ Years.</b></p>
            </div>
        </div>
        <div class="login-section">
            <img src="logo.png" class="login-logo" alt="SG Sound Serve Logo">
            
            <div class="auth-card">
                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="switchAuth('login')" id="tab-login">Existing Client</div>
                    <div class="auth-tab" onclick="switchAuth('register')" id="tab-register">New Partner</div>
                </div>
                <div id="form-login">
                    <div class="input-group"><label>Email Address</label><input type="email" id="login-email" placeholder="name@company.com"></div>
                    <div class="input-group"><label>Password</label><input type="password" id="login-pass" placeholder="Enter password"></div>
                    <a class="forgot-link" onclick="openForgotModal()">Forgot Password?</a>
                    <button class="btn btn-gold" style="width: 100%;" onclick="handleLogin()">SECURE LOGIN</button>
                </div>
                <div id="form-register" class="hidden">
                    <div class="input-group"><label>Username</label><input type="text" id="reg-user"></div>
                    <div class="input-group"><label>Official Email</label><input type="email" id="reg-email"></div>
                    <div class="input-group"><label>Phone Number</label><input type="tel" id="reg-phone"></div>
                    <div class="input-group"><label>Create Password</label><input type="password" id="reg-pass"></div>
                    <button class="btn btn-gold" style="width: 100%;" onclick="handleRegister()">CREATE ACCOUNT</button>
                </div>
            </div>
            <div style="margin-top: 20px;"><a href="admin.html" target="_blank" style="color: var(--text-muted); font-size: 0.8rem;">Admin Portal Access</a></div>
        </div>
    </section>

    <section id="main-app" class="hidden">
        <nav class="navbar">
            <div class="nav-logo" style="font-weight:700; font-size:1.2rem;"><i class="fas fa-layer-group" style="color:var(--accent-gold);"></i> SG SOUND</div>
            <div class="nav-menu">
                <span class="nav-item active" id="nav-home" onclick="goHome()">Dashboard</span>
                <span class="nav-item" id="nav-catalog" onclick="showCatalog()">Item Catalog</span>
                <span class="nav-item" id="nav-gallery" onclick="showGallery()">Gallery</span>
                <span class="nav-item" id="nav-about" onclick="showAbout()">About</span>
                <span class="nav-item" id="nav-terms" onclick="showTerms()">Terms</span>
                <span class="nav-item" id="nav-history" onclick="showHistory()">My Orders</span>
                <span class="nav-item" id="nav-connect" onclick="showConnect()">Connect</span>
                <span class="nav-item" id="nav-support" onclick="showSupport()">Support</span>
            </div>
            <div style="display:flex; align-items:center; gap:15px;">
                <div style="position:relative; cursor:pointer;" onclick="openCart()">
                    <i class="fas fa-shopping-bag" style="color:var(--accent-gold); font-size:1.2rem;"></i>
                    <span class="cart-badge" id="cart-count">0</span>
                </div>
                <button class="btn btn-outline" style="padding:5px 15px; font-size:0.8rem;" onclick="logout()">LOGOUT</button>
            </div>
        </nav>

        <div id="view-dashboard" class="dashboard-container">
            <div class="welcome-banner">
                <h2>Enterprise Dashboard</h2>
                <p style="color:var(--text-muted);">Welcome back, <span id="user-display" style="color:var(--accent-gold);">User</span></p>
            </div>

            <!-- NEW: DATE PICKER FOR AVAILABILITY -->
            <div class="date-picker-banner">
                <h3><i class="fas fa-calendar-check"></i> Check Equipment Availability</h3>
                <p style="color: var(--text-muted); margin-bottom: 15px;">Select your event date to see available equipment</p>
                <input type="date" id="booking-date" onchange="checkAvailability()">
                <button class="btn btn-gold" onclick="checkAvailability()">Check Availability</button>
                <div id="availability-msg" class="availability-status hidden"></div>
            </div>

            <div class="section-title">Services Portal</div>
            <div class="portals-grid">
                <div class="portal-card" onclick="openCategory('DJ Services')" style="background-image: url('images/dj.jpg');">
                    <div class="card-overlay"></div>
                    <div class="card-content">
                        <div class="card-title">DJ Services</div>
                        <small class="card-subtitle">Book Packages</small>
                    </div>
                </div>
                <div class="portal-card" onclick="openCategory('Rentals')" style="background-image: url('images/rentals.jpg');">
                    <div class="card-overlay"></div>
                    <div class="card-content">
                        <div class="card-title">Rentals</div>
                        <small class="card-subtitle">Full Sets</small>
                    </div>
                </div>
                <div class="portal-card" onclick="openCategory('Sales')" style="background-image: url('images/sales.jpg');">
                    <div class="card-overlay"></div>
                    <div class="card-content">
                        <div class="card-title">Pro Sales</div>
                        <small class="card-subtitle">Buy Equipment</small>
                    </div>
                </div>
                <div class="portal-card" onclick="showCatalog()" style="background-image: url('images/custom.jpg');">
                    <div class="card-overlay"></div>
                    <div class="card-content">
                        <div class="card-title">Custom Catalog</div>
                        <small class="card-subtitle">Individual Items</small>
                    </div>
                </div>
            </div>

            <div class="section-title">Featured Highlights</div>
            <div class="card-swap-wrapper">
                <div class="swap-container" id="swap-container"></div>
            </div>

            <div class="section-title">Our Expertise</div>
            <div class="flowing-menu-section" id="flowing-menu">
                <div class="flowing-bg-image" id="flowing-bg"></div>
                <div class="flowing-list">
                    <div class="flowing-item" onmouseenter="changeFlowImage('https://images.unsplash.com/photo-1598387993441-a364f854c3e1?q=80&w=2076&auto=format&fit=crop')">STUDIO RECORDING</div>
                    <div class="flowing-item" onmouseenter="changeFlowImage('https://images.unsplash.com/photo-1519750157634-b6d493a0f77c?q=80&w=2070&auto=format&fit=crop')">EVENT MANAGEMENT</div>
                    <div class="flowing-item" onmouseenter="changeFlowImage('https://images.unsplash.com/photo-1470225620780-dba8ba36b745?q=80&w=2070&auto=format&fit=crop')">DJ SERVICES</div>
                    <div class="flowing-item" onmouseenter="changeFlowImage('https://images.unsplash.com/photo-1516450360452-9312f5e86fc7?q=80&w=2070&auto=format&fit=crop')">LIGHTING PRODUCTION</div>
                </div>
            </div>
        </div>

        <!-- ENHANCED GALLERY WITH MEDIA SUPPORT -->
        <div id="view-gallery" class="hidden" style="width:100%;">
            <div class="gallery-hero">
                <div class="gallery-overlay"></div>
                <div class="gallery-hero-content">
                    <h1 class="gallery-main-title">SG SOUND <span style="color:var(--accent-gold);">GALLERY</span></h1>
                    <div class="gallery-nav-bar">
                        <span class="gallery-nav-link" onclick="goHome()">Dashboard</span>
                        <span class="gallery-nav-link">Weddings</span>
                        <span class="gallery-nav-link">Corporate Events</span>
                        <span class="gallery-nav-link">Parties</span>
                        <span class="gallery-nav-link">Concerts</span>
                    </div>
                </div>
            </div>
        
            <div class="dashboard-container">
                <div style="text-align:center;">
                    <h2 class="gallery-section-header">Our Productions</h2>
                </div>
        
                <!-- 
                HOW TO ADD YOUR OWN VIDEOS:
                1. Upload your video to YouTube
                2. Copy the video ID from the URL (e.g., if URL is https://www.youtube.com/watch?v=ABC123, the ID is ABC123)
                3. Replace the video ID in the embed URL below
                4. Format: https://www.youtube.com/embed/YOUR_VIDEO_ID
                
                For direct video files (.mp4, .webm):
                - Upload to your server in the 'uploads' folder
                - Use: <video src="uploads/your-video.mp4" muted loop autoplay></video>
                -->
        
                <div class="gallery-split-layout">
                    <!-- WEDDINGS - Add your wedding event video -->
                    <div class="gallery-display-item" onclick="playGalleryMedia('https://www.youtube.com/embed/YOUR_WEDDING_VIDEO_ID')">
                        <div class="gallery-img-wrapper">
                            <img src="https://images.unsplash.com/photo-1519750157634-b6d493a0f77c?q=80&w=2070&auto=format&fit=crop" alt="Wedding">
                            <div class="media-play-overlay"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="gallery-item-label">WEDDINGS üé¨</div>
                        <div class="gallery-item-sub">Elegant Sound & Lighting</div>
                    </div>
                    
                    <!-- CORPORATE EVENTS - Add your corporate event video -->
                    <div class="gallery-display-item" onclick="playGalleryMedia('https://www.youtube.com/embed/YOUR_CORPORATE_VIDEO_ID')">
                        <div class="gallery-img-wrapper">
                            <img src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?q=80&w=2070&auto=format&fit=crop" alt="Event">
                            <div class="media-play-overlay"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="gallery-item-label">CORPORATE EVENTS üé¨</div>
                        <div class="gallery-item-sub">Conferences & Product Launches</div>
                    </div>
                </div>
        
                <div class="gallery-split-layout">
                    <!-- PARTIES - Add your party event video -->
                    <div class="gallery-display-item" onclick="playGalleryMedia('https://www.youtube.com/embed/YOUR_PARTY_VIDEO_ID')">
                        <div class="gallery-img-wrapper">
                            <img src="https://images.unsplash.com/photo-1514525253161-7a46d19cd819?q=80&w=2070&auto=format&fit=crop" alt="Party">
                            <div class="media-play-overlay"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="gallery-item-label">PARTIES üé¨</div>
                        <div class="gallery-item-sub">DJ Sets & Dance Floors</div>
                    </div>
                    
                    <!-- CONCERTS - Add your concert video -->
                    <div class="gallery-display-item" onclick="playGalleryMedia('https://www.youtube.com/embed/YOUR_CONCERT_VIDEO_ID')">
                        <div class="gallery-img-wrapper">
                            <img src="https://images.unsplash.com/photo-1501386761578-eac5c94b800a?q=80&w=2070&auto=format&fit=crop" alt="Concert">
                            <div class="media-play-overlay"><i class="fas fa-play"></i></div>
                        </div>
                        <div class="gallery-item-label">CONCERTS üé¨</div>
                        <div class="gallery-item-sub">Live Sound Engineering</div>
                    </div>
                </div>
                
                
                <!-- FEATURE 3: Client Testimonials Section -->
                <div style="text-align:center; margin:80px 0 40px 0;">
                    <h2 class="gallery-section-header">Client Testimonials</h2>
                    <p style="color:var(--text-muted); max-width:600px; margin:0 auto 50px auto;">
                        Hear from our satisfied clients about their experiences with SG Sound Serve
                    </p>
                </div>
                
                <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:30px; margin-bottom:60px;">
                    <div style="background:var(--bg-panel); padding:30px; border-radius:16px; border:var(--border);">
                        <div style="color:var(--accent-gold); font-size:2rem; margin-bottom:15px;">"</div>
                        <p style="font-style:italic; margin-bottom:20px; line-height:1.6;">
                            SG Sound Serve transformed our wedding reception into an unforgettable experience. 
                            The sound quality was crystal clear and the team was incredibly professional.
                        </p>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:50%; background:var(--accent-gold); display:flex; align-items:center; justify-content:center; color:#0f172a; font-weight:bold; font-size:1.2rem;">R</div>
                            <div>
                                <div style="font-weight:600;">Rajesh & Priya</div>
                                <div style="font-size:0.85rem; color:var(--text-muted);">Wedding Sangeet, December 2024</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background:var(--bg-panel); padding:30px; border-radius:16px; border:var(--border);">
                        <div style="color:var(--accent-gold); font-size:2rem; margin-bottom:15px;">"</div>
                        <p style="font-style:italic; margin-bottom:20px; line-height:1.6;">
                            We've used SG Sound for multiple corporate events. Their equipment is top-notch 
                            and they always deliver beyond expectations.
                        </p>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:50%; background:var(--accent-gold); display:flex; align-items:center; justify-content:center; color:#0f172a; font-weight:bold; font-size:1.2rem;">A</div>
                            <div>
                                <div style="font-weight:600;">Anjali Mehta</div>
                                <div style="font-size:0.85rem; color:var(--text-muted);">Event Manager, TechCorp India</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background:var(--bg-panel); padding:30px; border-radius:16px; border:var(--border);">
                        <div style="color:var(--accent-gold); font-size:2rem; margin-bottom:15px;">"</div>
                        <p style="font-style:italic; margin-bottom:20px; line-height:1.6;">
                            The DJ service was phenomenal! Everyone at the party couldn't stop talking about 
                            the music selection and energy. Highly recommended!
                        </p>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div style="width:50px; height:50px; border-radius:50%; background:var(--accent-gold); display:flex; align-items:center; justify-content:center; color:#0f172a; font-weight:bold; font-size:1.2rem;">V</div>
                            <div>
                                <div style="font-weight:600;">Vikram Singh</div>
                                <div style="font-size:0.85rem; color:var(--text-muted);">Birthday Party, November 2024</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div style="text-align:center; margin-bottom:50px;">
                    <button class="btn btn-outline" onclick="goHome()">BACK TO DASHBOARD</button>
                </div>
            </div>
        </div>

        <div id="view-about" class="dashboard-container hidden">
            <div class="category-header"><h2>About Us</h2><button class="btn btn-outline" onclick="goHome()">Back to Dashboard</button></div>
            <h1 class="about-header">Get to know me</h1>
            <div class="about-content">
                <p>I am the Founder of SG Sound Serve, a pioneer in the world of professional audio and event production. Following in my father's footsteps of excellence, I have dedicated my career to mastering sound engineering and live event production.</p>
                <p style="margin-top:15px;">With over a decade of experience, I transitioned my passion for sound into a thriving career in the audio industry. My journey is fueled by passion and dedication, crafting high-quality audio experiences that resonate with creativity and technical precision.</p>
            </div>
            <ul class="about-list">
                <li>10+ Years of Experience</li>
                <li>Certified Sound Engineer</li>
                <li>Live Event Specialist</li>
                <li>Professional DJ & Producer</li>
            </ul>
            <div class="about-image-container">
                <img src="https://images.unsplash.com/photo-1598387993441-a364f854c3e1?q=80&w=2076&auto=format&fit=crop" class="about-image" alt="Profile Picture">
            </div>
            <div class="about-grid">
                <div class="about-card">
                    <h3>My Studio</h3>
                    <p>SG Sound Serve is a culmination of my journey and passion for sound. Located in Chennai, our studio offers world-class services in recording, mixing, mastering, and live event production. With a focus on precision and artistry, we provide a seamless blend of technical expertise and creative collaboration to bring every project to life.</p>
                </div>
                <div class="about-card">
                    <h3>My Vision</h3>
                    <p>At SG Sound Serve, my vision is to craft world-class audio experiences that preserve the timeless, classic tone in every project. Looking ahead, I aspire to venture into cutting-edge audio technologies, blending tradition with innovation to redefine the possibilities of sound and music production.</p>
                </div>
            </div>
        </div>

        <!-- TERMS & CONDITIONS SECTION -->
        <div id="view-terms" class="dashboard-container hidden">
            <div class="category-header"><h2>Terms & Conditions</h2><button class="btn btn-outline" onclick="goHome()">Back to Dashboard</button></div>
            
            <div style="background:var(--bg-panel); padding:30px; border-radius:16px; border:1px solid rgba(255,255,255,0.1); margin-bottom:20px;">
                <h3 style="color:var(--accent-gold); margin-bottom:20px; font-size:1.5rem;"><i class="fas fa-file-contract"></i> Rental Terms & Policies</h3>
                
                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">üìÖ Booking & Reservations</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li>All bookings require a <strong style="color:white;">50% advance payment</strong> to confirm the reservation</li>
                        <li>Balance amount must be settled <strong style="color:white;">24 hours before</strong> the event</li>
                        <li>Booking dates are subject to availability - first come, first served</li>
                        <li>Last-minute bookings (within 48 hours) may incur a <strong style="color:var(--accent-gold);">rush fee of ‚Çπ2,000</strong></li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">üöö Delivery & Setup</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">Transport Charges (Chennai City):</strong> Free within 10km radius, ‚Çπ500-‚Çπ1,000 beyond</li>
                        <li><strong style="color:white;">ECR/OMR Areas:</strong> Additional ‚Çπ1,500-‚Çπ2,000 transport charge</li>
                        <li><strong style="color:white;">Outstation Events:</strong> Custom quote based on distance</li>
                        <li>Equipment will be delivered 2-3 hours before event start time</li>
                        <li>Professional setup and sound check included in DJ Service packages</li>
                        <li>Pickup scheduled within 2 hours after event completion</li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">‚è∞ Rental Duration</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">Standard Rental Period:</strong> 8 hours (single day)</li>
                        <li><strong style="color:white;">Overtime Charges:</strong> ‚Çπ500-‚Çπ1,500 per hour (equipment dependent)</li>
                        <li><strong style="color:white;">Multi-day Rentals:</strong> Contact for special rates</li>
                        <li>DJ Service packages typically include 4-6 hours of performance</li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">üí∞ Payment & Refunds</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">Accepted Payment Methods:</strong> Cash, UPI, Bank Transfer, Credit/Debit Cards</li>
                        <li><strong style="color:white;">GST:</strong> 18% GST applicable on all services</li>
                        <li><strong style="color:white;">Security Deposit:</strong> ‚Çπ5,000-‚Çπ20,000 (refundable, equipment dependent)</li>
                        <li><strong style="color:white;">Cancellation Policy:</strong>
                            <ul style="margin-top:10px; margin-left:20px;">
                                <li>More than 7 days before event: Full refund minus 10% processing fee</li>
                                <li>3-7 days before event: 50% refund</li>
                                <li>Less than 3 days: No refund, advance forfeited</li>
                                <li>Rescheduling allowed once free of charge (subject to availability)</li>
                            </ul>
                        </li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">üõ°Ô∏è Damage & Liability</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">Equipment Care:</strong> Client is responsible for equipment safety during rental period</li>
                        <li><strong style="color:white;">Damage Charges:</strong> Repair/replacement cost deducted from security deposit</li>
                        <li><strong style="color:white;">Loss or Theft:</strong> Client liable for full replacement value</li>
                        <li><strong style="color:white;">Weather Protection:</strong> Client must provide covered area for equipment in outdoor events</li>
                        <li>Our team will inspect all equipment before and after the event</li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">‚ö° Technical Support</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">DJ Services:</strong> Professional DJ/technician included on-site</li>
                        <li><strong style="color:white;">Equipment Rentals:</strong> Basic setup guidance provided, on-site technician available at extra charge (‚Çπ2,000-‚Çπ5,000)</li>
                        <li><strong style="color:white;">Technical Assistance:</strong> Phone support available during rental period</li>
                        <li><strong style="color:white;">Backup Equipment:</strong> Available upon request for critical events</li>
                    </ul>
                </div>

                <div style="margin-bottom:30px;">
                    <h4 style="color:white; margin-bottom:10px; font-size:1.2rem;">üìã Additional Terms</h4>
                    <ul style="color:var(--text-muted); line-height:1.8; margin-left:20px;">
                        <li><strong style="color:white;">Power Requirements:</strong> Client must provide adequate power supply (230V, grounded outlets)</li>
                        <li><strong style="color:white;">Generator Required?</strong> Notify us in advance - rental available at ‚Çπ5,500/day</li>
                        <li><strong style="color:white;">Access:</strong> Clear and safe loading/unloading access required at venue</li>
                        <li><strong style="color:white;">Parking:</strong> Free parking space for our delivery vehicle required</li>
                        <li><strong style="color:white;">Content Responsibility:</strong> Client responsible for copyright/licensing of music/media played</li>
                        <li><strong style="color:white;">Force Majeure:</strong> SG Sound Serve not liable for delays due to natural disasters, strikes, or government orders</li>
                    </ul>
                </div>

                <div style="margin-top:40px; padding:20px; background:rgba(251,191,36,0.1); border-left:4px solid var(--accent-gold); border-radius:8px;">
                    <h4 style="color:var(--accent-gold); margin-bottom:10px;"><i class="fas fa-phone-alt"></i> Pro-Tip for Chennai Events</h4>
                    <p style="color:var(--text-muted); line-height:1.6;">
                        For events in ECR or OMR areas, expect additional transport charges of ‚Çπ1,500-‚Çπ2,000. Plan ahead for outdoor events during monsoon season (Oct-Dec) - waterproof covers and backup plans recommended!
                    </p>
                </div>

                <div style="margin-top:30px; text-align:center; padding-top:20px; border-top:1px solid rgba(255,255,255,0.1);">
                    <p style="color:var(--text-muted); font-size:0.9rem;">
                        By booking our services, you agree to these terms and conditions. For clarifications or custom requirements, please contact us.
                    </p>
                    <button class="btn btn-gold" onclick="showConnect()" style="margin-top:15px;">
                        <i class="fas fa-phone"></i> Contact Us for Queries
                    </button>
                </div>
            </div>
        </div>

        <div id="view-catalog" class="dashboard-container hidden">
            <div class="category-header"><h2>Item Catalog</h2><button class="btn btn-outline" onclick="goHome()">Back</button></div>
            <div class="catalog-layout">
                <div class="catalog-sidebar">
                    <div class="catalog-filter active" onclick="filterCatalog('All')">All Items</div>
                    <div class="catalog-filter" onclick="filterCatalog('Microphones')">Microphones</div>
                    <div class="catalog-filter" onclick="filterCatalog('Lighting')">Lighting</div>
                    <div class="catalog-filter" onclick="filterCatalog('Effects')">Effects</div>
                    <div class="catalog-filter" onclick="filterCatalog('Power')">Power</div>
                    <div class="catalog-filter" onclick="filterCatalog('Visual')">Visual</div>
                    <div class="catalog-filter" onclick="filterCatalog('Monitors')">Monitors</div>
                    <div class="catalog-filter" onclick="filterCatalog('Communication')">Communication</div>
                </div>
                <div class="catalog-items" id="catalog-grid"></div>
            </div>
        </div>

        <div id="view-products" class="dashboard-container hidden">
            <div class="category-header"><h2 id="cat-title-display">Category</h2><button class="btn btn-outline" onclick="goHome()">Back</button></div>
            <div class="products-grid" id="product-list"></div>
        </div>

        <div id="view-history" class="dashboard-container hidden">
            <div class="category-header"><h2>Quote History</h2><button class="btn btn-outline" onclick="goHome()">Back</button></div>
            <table class="bill-table" style="background:var(--bg-panel); color:white; border-radius:8px;">
                <thead><tr><th>Order ID</th><th>Order Date</th><th>Event Date</th><th>Items</th><th style="text-align:right;">Total</th><th>Status</th></tr></thead>
                <tbody id="history-table-body"></tbody>
            </table>
        </div>

        <div id="view-connect" class="dashboard-container hidden">
            <div class="category-header"><h2>Connect</h2><button class="btn btn-outline" onclick="goHome()">Back</button></div>
            <div class="connect-grid">
                <div class="shop-detail-card">
                    <h3><i class="fas fa-store"></i> SG SOUND SERVE</h3>
                    <div class="info-row" style="margin-top:20px;"><div class="info-icon"><i class="fas fa-map-marker-alt"></i></div><div><strong>Main Showroom</strong><br><small>105/105A Sanyasipuram, Kilpauk<br>Chennai, Tamil Nadu 600010</small></div></div>
                    <div class="info-row"><div class="info-icon"><i class="fas fa-clock"></i></div><div><strong>Hours</strong><br><small>10 AM - 9 PM</small></div></div>
                </div>
                <div class="shop-detail-card">
                    <h3>Social Handles</h3>
                    <a href="https://instagram.com" target="_blank" class="social-card"><i class="fab fa-instagram"></i> Follow on Instagram</a>
                    <a href="https://wa.me/919841322784" target="_blank" class="social-card"><i class="fab fa-whatsapp"></i> Chat on WhatsApp</a>
                    <a href="https://www.youtube.com/shorts/YPLZ_xMN0xY" target="_blank" class="social-card"><i class="fab fa-youtube"></i> Subscribe on YouTube</a>
                    <a href="https://maps.app.goo.gl/GiyjWoAer8Fgg7Db6" target="_blank" class="social-card"><i class="fas fa-map"></i> Google Maps</a>
                </div>
            </div>
        </div>
        
        <div id="view-support" class="dashboard-container hidden">
             <div class="category-header"><h2>Support Center</h2><button class="btn btn-outline" onclick="goHome()">Back</button></div>
             <div class="shop-detail-card">
                 <label>Subject</label><input type="text" id="ticket-subject" class="input-group" style="width:100%; padding:10px; margin-bottom:10px;">
                 <label>Message</label><textarea id="ticket-desc" style="width:100%; height:100px; background:#0f172a; border:1px solid #333; color:white; padding:10px;"></textarea>
                 <button class="btn btn-gold" style="margin-top:10px;" onclick="submitTicket()">Submit Ticket</button>
             </div>
        </div>
    </section>

    <!-- MFA VERIFICATION MODAL -->
    <div id="modal-mfa" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:420px; text-align:center; background: rgba(30,41,59,0.92); backdrop-filter: blur(24px); border: 1px solid rgba(251,191,36,0.25); box-shadow: 0 30px 80px rgba(0,0,0,0.7);">
            <div style="margin-bottom:24px;">
                <div style="width:70px; height:70px; border-radius:50%; background:linear-gradient(135deg,rgba(251,191,36,0.2),rgba(59,130,246,0.15)); border:2px solid rgba(251,191,36,0.4); display:flex; align-items:center; justify-content:center; margin:0 auto 16px auto;">
                    <i class="fas fa-shield-alt" style="font-size:1.8rem; color:var(--accent-gold);"></i>
                </div>
                <h3 style="color:white; font-size:1.5rem; font-weight:700; margin-bottom:6px;">Two-Factor Authentication</h3>
                <p style="color:var(--text-muted); font-size:0.9rem; line-height:1.5;">A 6-digit verification code has been sent to your email. Enter it below to complete sign-in.</p>
            </div>
            <div style="display:flex; gap:10px; justify-content:center; margin-bottom:20px;" id="otp-boxes">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d0" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,0)" onkeydown="otpBack(event,this,0)">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d1" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,1)" onkeydown="otpBack(event,this,1)">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d2" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,2)" onkeydown="otpBack(event,this,2)">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d3" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,3)" onkeydown="otpBack(event,this,3)">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d4" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,4)" onkeydown="otpBack(event,this,4)">
                <input type="text" maxlength="1" class="otp-digit" id="otp-d5" style="width:48px; height:56px; text-align:center; font-size:1.4rem; font-weight:700; background:rgba(15,23,42,0.8); border:1.5px solid rgba(255,255,255,0.15); border-radius:10px; color:white; outline:none; transition:border 0.2s;" oninput="otpAdvance(this,5)" onkeydown="otpBack(event,this,5)">
            </div>
            <div id="mfa-error" class="hidden" style="background:rgba(239,68,68,0.15); border:1px solid rgba(239,68,68,0.4); color:#f87171; padding:10px 16px; border-radius:8px; font-size:0.85rem; margin-bottom:16px;"></div>
            <button class="btn btn-gold" style="width:100%; margin-bottom:10px; font-size:1rem;" onclick="verifyMFA()"><i class="fas fa-check-circle"></i> Verify &amp; Sign In</button>
            <button class="btn btn-outline" style="width:100%; font-size:0.85rem;" onclick="cancelMFA()">Cancel / Back to Login</button>
            <p style="color:var(--text-muted); font-size:0.78rem; margin-top:14px;"><i class="fas fa-info-circle"></i> Didn't receive an email? Check spam or try again.</p>
        </div>
    </div>

    <!-- MODALS -->
    <div id="modal-forgot" class="modal-overlay hidden">
        <div class="modal-box">
            <h3>Reset Password</h3>
            <div id="forgot-step-1">
                <p>Enter your registered email to receive an OTP.</p>
                <input type="email" id="forgot-email" placeholder="Email Address" style="width:100%; padding:10px; margin:10px 0; background:#0f172a; border:1px solid #444; color:white;">
                <button class="btn btn-gold" onclick="sendOTP()">Send OTP</button>
            </div>
            <div id="forgot-step-2" class="hidden">
                <p>OTP Sent! Enter details below.</p>
                <input type="text" id="otp-input" placeholder="Enter OTP" style="width:100%; padding:10px; margin:5px 0; background:#0f172a; border:1px solid #444; color:white;">
                <input type="password" id="new-pass" placeholder="New Password" style="width:100%; padding:10px; margin:5px 0; background:#0f172a; border:1px solid #444; color:white;">
                <input type="password" id="confirm-pass" placeholder="Confirm Password" style="width:100%; padding:10px; margin:5px 0; background:#0f172a; border:1px solid #444; color:white;">
                <button class="btn btn-gold" onclick="resetPassword()">Update Password</button>
            </div>
            <button class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="document.getElementById('modal-forgot').classList.add('hidden')">Cancel</button>
        </div>
    </div>
    
    <div id="modal-booking" class="modal-overlay hidden">
        <div class="modal-box">
            <h3 id="book-name">Configure</h3>
            <div id="book-inputs"></div>
            <button class="btn btn-gold" style="width:100%; margin-top:20px;" onclick="confirmAddToCart()">Add to Cart</button>
            <button class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="document.getElementById('modal-booking').classList.add('hidden')">Cancel</button>
        </div>
    </div>

    <div id="modal-cart" class="modal-overlay hidden">
        <div class="modal-box" style="max-width:700px;">
            <h3>Your Quote Cart</h3>
            <div id="cart-step">
                <div id="cart-items" style="max-height:300px; overflow-y:auto; margin:20px 0;"></div>
                <label>Contact Number (For Bill)</label>
                <input type="tel" id="bill-phone" placeholder="9999999999" maxlength="10" oninput="this.value = this.value.replace(/[^0-9]/g, '').slice(0, 10)" style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #444; color:white;">
                <label>Email Address (For Bill)</label>
                <input type="email" id="bill-email" placeholder="name@company.com" style="width:100%; padding:10px; margin-bottom:15px; background:#0f172a; border:1px solid #444; color:white;">
                <button class="btn btn-gold" style="width:100%;" onclick="generateBill()">Generate Bill</button>
            </div>
            <div id="bill-step" class="hidden">
                <div class="invoice-paper">
                    <div style="display:flex; justify-content:space-between; border-bottom:2px solid #333; padding-bottom:10px;">
                        <h3>INVOICE</h3>
                        <div style="text-align:right;">
                            <small>Date: <span id="bill-date"></span></small><br>
                            <small>Event Date: <span id="bill-booking-date"></span></small>
                        </div>
                    </div>
                    <div style="margin:10px 0;"><strong>Bill To:</strong> <span id="bill-user"></span><br><strong>Contact:</strong> <span id="bill-phone-display"></span><br><strong>Email:</strong> <span id="bill-email-display"></span></div>
                    <table class="bill-table"><thead><tr><th>Item</th><th style="text-align:right;">Amount</th></tr></thead><tbody id="bill-body"></tbody></table>
                    <div style="text-align:right; border-top:2px solid #333; padding-top:10px;"><h3>Total: ‚Çπ<span id="bill-total">0</span></h3></div>
                </div>
                <button class="btn btn-gold" style="width:100%; margin-top:20px;" onclick="sendOrder()">Submit Quote Request</button>
            </div>
            <button class="btn btn-outline" style="width:100%; margin-top:10px;" onclick="document.getElementById('modal-cart').classList.add('hidden')">Close</button>
        </div>
    </div>

    <!-- Media Player Modal -->
    <div id="modal-media" class="modal-overlay hidden" onclick="closeMediaPlayer()">
        <div class="modal-box" style="max-width:900px;" onclick="event.stopPropagation()">
            <div id="media-container" style="width:100%; aspect-ratio:16/9; background:#000;">
                <iframe id="media-frame" width="100%" height="100%" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>
            </div>
            <button class="btn btn-outline" style="width:100%; margin-top:15px;" onclick="closeMediaPlayer()">Close</button>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:5001/api";
        const BASE_URL = "http://localhost:5001";
        let currentUser = "";
        let currentUserEmail = "";
        let products = [];
        let catalogList = [];
        let cart = [];
        let currentCategory = "";
        let selectedBookingDate = "";

        async function loadData() {
            try {
                const pRes = await fetch(API_URL + '/products');
                products = await pRes.json();
                const cRes = await fetch(API_URL + '/catalog');
                catalogList = await cRes.json();
            } catch(e) { console.error("Load Error:", e); }
        }

        function switchAuth(type) {
            document.getElementById('tab-login').classList.toggle('active', type === 'login');
            document.getElementById('tab-register').classList.toggle('active', type === 'register');
            document.getElementById('form-login').classList.toggle('hidden', type !== 'login');
            document.getElementById('form-register').classList.toggle('hidden', type !== 'register');
        }

        let mfaPendingEmail = "";  // holds email between login and MFA verify steps

        async function handleLogin() {
            const isLogin = !document.getElementById('form-login').classList.contains('hidden');
            if(isLogin) {
                const email = document.getElementById('login-email').value;
                const pass = document.getElementById('login-pass').value;
                if(!email || !pass) return alert("Fill all fields");
                try {
                    const res = await fetch(API_URL + '/login', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email, password:pass})});
                    const data = await res.json();
                    if(data.success && data.mfa_required) {
                        mfaPendingEmail = data.email;  // store email returned by server
                        // Show MFA modal ‚Äî clear any previous OTP inputs
                        document.querySelectorAll('.otp-digit').forEach(el => { el.value = ''; el.style.border = '1.5px solid rgba(255,255,255,0.15)'; });
                        document.getElementById('mfa-error').classList.add('hidden');
                        document.getElementById('modal-mfa').classList.remove('hidden');
                        setTimeout(() => document.getElementById('otp-d0').focus(), 100);
                    } else { alert("Invalid credentials"); }
                } catch(e) { alert("Login failed"); }
            }
        }

        function otpAdvance(input, idx) {
            input.value = input.value.replace(/[^0-9]/g, '');
            input.style.border = '1.5px solid rgba(251,191,36,0.6)';
            if(input.value && idx < 5) {
                document.getElementById('otp-d' + (idx + 1)).focus();
            }
        }

        function otpBack(e, input, idx) {
            if(e.key === 'Backspace' && !input.value && idx > 0) {
                document.getElementById('otp-d' + (idx - 1)).focus();
            }
            if(e.key === 'Enter') verifyMFA();
        }

        async function verifyMFA() {
            const otp = Array.from(document.querySelectorAll('.otp-digit')).map(el => el.value).join('');
            if(otp.length < 6) {
                const err = document.getElementById('mfa-error');
                err.textContent = 'Please enter all 6 digits of your OTP.';
                err.classList.remove('hidden');
                return;
            }
            try {
                // Send email + otp ‚Äî no session/cookie dependency, works cross-origin
                const res = await fetch(API_URL + '/verify-mfa', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email: mfaPendingEmail, otp})});
                const data = await res.json();
                if(data.success) {
                    currentUser = data.user;
                    currentUserEmail = data.email;
                    mfaPendingEmail = "";
                    document.getElementById('modal-mfa').classList.add('hidden');
                    document.getElementById('landing-page').classList.add('hidden');
                    document.getElementById('main-app').classList.remove('hidden');
                    document.getElementById('user-display').innerText = currentUser;
                    await loadData();
                    initCardSwap();
                } else {
                    const err = document.getElementById('mfa-error');
                    err.textContent = data.msg || 'Invalid OTP. Please try again.';
                    err.classList.remove('hidden');
                    document.querySelectorAll('.otp-digit').forEach(el => { el.value = ''; el.style.border = '1.5px solid rgba(239,68,68,0.5)'; });
                    document.getElementById('otp-d0').focus();
                }
            } catch(e) {
                const err = document.getElementById('mfa-error');
                err.textContent = 'Verification failed. Please try again.';
                err.classList.remove('hidden');
            }
        }

        function cancelMFA() {
            document.getElementById('modal-mfa').classList.add('hidden');
            document.querySelectorAll('.otp-digit').forEach(el => el.value = '');
            mfaPendingEmail = "";
        }

        async function handleRegister() {
            const username = document.getElementById('reg-user').value;
            const email = document.getElementById('reg-email').value;
            const password = document.getElementById('reg-pass').value;
            if(!username || !email || !password) return alert("Fill all fields");
            try {
                const res = await fetch(API_URL + '/register', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({username, email, password})});
                const data = await res.json();
                if(data.success) {
                    alert("Registration successful! Please login.");
                    switchAuth('login');
                } else { alert(data.msg || "Registration failed"); }
            } catch(e) { alert("Error during registration"); }
        }

        function logout() {
            currentUser = "";
            currentUserEmail = "";
            cart = [];
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('landing-page').classList.remove('hidden');
        }

        function openForgotModal() {
            document.getElementById('modal-forgot').classList.remove('hidden');
            document.getElementById('forgot-step-1').classList.remove('hidden');
            document.getElementById('forgot-step-2').classList.add('hidden');
        }

        async function sendOTP() {
            const email = document.getElementById('forgot-email').value;
            if(!email) return alert("Enter email");
            try {
                const res = await fetch(API_URL + '/forgot-password', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email})});
                const data = await res.json();
                if(data.success) {
                    document.getElementById('forgot-step-1').classList.add('hidden');
                    document.getElementById('forgot-step-2').classList.remove('hidden');
                } else { alert(data.msg); }
            } catch(e) { alert("Error sending OTP"); }
        }

        async function resetPassword() {
            const email = document.getElementById('forgot-email').value;
            const otp = document.getElementById('otp-input').value;
            const newPass = document.getElementById('new-pass').value;
            const confirmPass = document.getElementById('confirm-pass').value;
            if(!otp || !newPass || !confirmPass) return alert("Fill all fields");
            if(newPass !== confirmPass) return alert("Passwords don't match");
            try {
                const res = await fetch(API_URL + '/reset-password', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({email, otp, new_pass: newPass})});
                const data = await res.json();
                if(data.success) {
                    alert("Password updated successfully!");
                    document.getElementById('modal-forgot').classList.add('hidden');
                } else { alert(data.msg); }
            } catch(e) { alert("Error resetting password"); }
        }

        // NEW: Check Availability Function
        async function checkAvailability() {
            const dateInput = document.getElementById('booking-date');
            const bookingDate = dateInput.value;
            
            if(!bookingDate) {
                alert("Please select a date first");
                return;
            }
            
            selectedBookingDate = bookingDate;
            
            try {
                const res = await fetch(API_URL + '/availability', {
                    method: 'POST',
                    headers: {'Content-Type':'application/json'},
                    body: JSON.stringify({booking_date: bookingDate})
                });
                const data = await res.json();
                
                if(data.success) {
                    products = data.products;
                    const msgDiv = document.getElementById('availability-msg');
                    msgDiv.classList.remove('hidden');
                    
                    if(products.length === 0) {
                        msgDiv.className = 'availability-status warning';
                        msgDiv.innerHTML = '<i class="fas fa-exclamation-triangle"></i> No equipment available for this date. Please try another date.';
                    } else {
                        msgDiv.className = 'availability-status success';
                        msgDiv.innerHTML = `<i class="fas fa-check-circle"></i> ${products.length} items available for ${bookingDate}. ${data.booked_count > 0 ? `(${data.booked_count} items already booked)` : ''}`;
                    }
                } else {
                    alert("Error checking availability");
                }
            } catch(e) {
                console.error("Availability check error:", e);
                alert("Error checking availability");
            }
        }

        function goHome() {
            ['dashboard','catalog','gallery','about','products','history','connect','support'].forEach(v => {
                document.getElementById('view-'+v).classList.add('hidden');
                const nav = document.getElementById('nav-'+v.replace('products','home'));
                if(nav) nav.classList.remove('active');
            });
            document.getElementById('view-dashboard').classList.remove('hidden');
            document.getElementById('nav-home').classList.add('active');
        }

        function showCatalog() {
            goToView('catalog');
            renderCatalog('All');
        }

        function showGallery() { 
            goToView('gallery');
            // Pause all autoplaying videos when switching views to prevent performance issues
            setTimeout(() => {
                const videos = document.querySelectorAll('#view-gallery video');
                videos.forEach(video => {
                    if (video.paused) {
                        video.play().catch(() => {}); // Restart autoplay videos
                    }
                });
            }, 100);
        }
        function showAbout() { goToView('about'); }
        function showTerms() { goToView('terms'); }
        function showHistory() { goToView('history'); loadHistory(); }
        function showConnect() { goToView('connect'); }
        function showSupport() { goToView('support'); }

        function goToView(name) {
            // Pause all videos in the gallery before switching views
            const galleryVideos = document.querySelectorAll('#view-gallery video');
            galleryVideos.forEach(video => video.pause());
            
            ['dashboard','catalog','gallery','about','terms','products','history','connect','support'].forEach(v => {
                document.getElementById('view-'+v).classList.add('hidden');
                const nav = document.getElementById('nav-'+v.replace('products','home'));
                if(nav) nav.classList.remove('active');
            });
            document.getElementById('view-'+name).classList.remove('hidden');
            const navItem = document.getElementById('nav-'+name);
            if(navItem) navItem.classList.add('active');
        }

        async function openCategory(cat) {
            if(!selectedBookingDate) {
                alert("Please select an event date first to check availability!");
                return;
            }
            currentCategory = cat;
            document.getElementById('cat-title-display').innerText = cat;
            
            // Fetch available products for the selected date
            try {
                const res = await fetch(`${API_URL}/available-products?date=${selectedBookingDate}`);
                const data = await res.json();
                
                if (data.success) {
                    const availableForCategory = data.products.filter(p => p.cat === cat);
                    
                    document.getElementById('product-list').innerHTML = availableForCategory.map(p => {
                        // Handle image or icon display
                        let imgContent;
                        if (p.image) {
                            imgContent = `<img src="${BASE_URL}/uploads/${p.image}" class="product-img" alt="${p.name}">`;
                        } else {
                            imgContent = `<div style="width:100%; height:180px; background:linear-gradient(135deg, #1e293b, #0f172a); display:flex; align-items:center; justify-content:center; border-radius:8px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.1);"><i class="${p.icon}" style="font-size:3rem; color:var(--accent-gold);"></i></div>`;
                        }
                        
                        const sampleBtn = p.sample_url ? `<a href="${p.sample_url}" target="_blank" class="sample-media-btn"><i class="fas fa-play-circle"></i> View Sample</a>` : '';
                        return `
                            <div class="product-card">
                                ${imgContent}
                                <h3 style="margin:10px 0; color:white;">${p.name}</h3>
                                <p style="color:var(--text-muted); font-size:0.9rem; margin-bottom:10px;">${p.cat}</p>
                                <p style="color:var(--accent-gold); font-size:1.3rem; font-weight:700; margin-bottom:10px;">‚Çπ${p.price.toLocaleString('en-IN')}</p>
                                ${sampleBtn}
                                <button class="btn btn-gold" style="width:100%; margin-top:10px;" onclick='openBooking(${JSON.stringify(p)})'>Configure</button>
                            </div>
                        `;
                    }).join('');
                    
                    if (availableForCategory.length === 0) {
                        document.getElementById('product-list').innerHTML = `
                            <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                                <i class="fas fa-calendar-times" style="font-size: 3rem; color: var(--accent-gold); margin-bottom: 20px;"></i>
                                <h3>No items available</h3>
                                <p>All items in this category are already booked for ${selectedBookingDate}</p>
                            </div>
                        `;
                    }
                } else {
                    alert('Error loading available products. Please try again.');
                }
            } catch (e) {
                console.error('Error fetching available products:', e);
                alert('Error checking availability. Please try again.');
            }
            
            goToView('products');
        }

        function renderCatalog(filter) {
            const filtered = filter === 'All' ? catalogList : catalogList.filter(i => i.cat === filter);
            
            // Icon mapping for categories
            const categoryIcons = {
                'Microphones': 'fas fa-microphone',
                'Lighting': 'fas fa-lightbulb',
                'Effects': 'fas fa-magic',
                'Power': 'fas fa-bolt',
                'Visual': 'fas fa-tv',
                'Monitors': 'fas fa-desktop',
                'Communication': 'fas fa-walkie-talkie'
            };
            
            document.getElementById('catalog-grid').innerHTML = filtered.map(item => {
                let imgContent;
                if (item.image) {
                    imgContent = `<img src="${BASE_URL}/uploads/${item.image}" class="product-img" alt="${item.name}">`;
                } else {
                    const icon = categoryIcons[item.cat] || 'fas fa-box';
                    imgContent = `<div style="width:100%; height:180px; background:linear-gradient(135deg, #1e293b, #0f172a); display:flex; align-items:center; justify-content:center; border-radius:8px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.1);"><i class="${icon}" style="font-size:3rem; color:var(--accent-gold);"></i></div>`;
                }
                
                return `
                    <div class="product-card">
                        ${imgContent}
                        <h3 style="margin:10px 0; color:white;">${item.name}</h3>
                        <p style="color:var(--text-muted); font-size:0.9rem;">${item.cat}</p>
                        <p style="color:var(--accent-gold); font-size:1.2rem; font-weight:700; margin-top:5px;">‚Çπ${item.price.toLocaleString('en-IN')}</p>
                        <button class="btn btn-gold" style="width:100%; margin-top:10px;" onclick='addToCartDirect("${item.name}", ${item.price})'>Add to Cart</button>
                    </div>
                `;
            }).join('');
        }

        function filterCatalog(type) {
            document.querySelectorAll('.catalog-filter').forEach(f => f.classList.remove('active'));
            event.target.classList.add('active');
            renderCatalog(type);
        }

        function openBooking(product) {
            window.currentProduct = product;
            document.getElementById('book-name').innerText = product.name;
            document.getElementById('book-inputs').innerHTML = `
                <label>Configuration (Days/Hours/Unit)</label>
                <input type="text" id="book-desc" placeholder="e.g., 1 day" style="width:100%; padding:10px; background:#0f172a; border:1px solid #444; color:white; margin-bottom:10px;">
                <label>Total Amount</label>
                <input type="number" id="book-total" value="${product.price}" style="width:100%; padding:10px; background:#0f172a; border:1px solid #444; color:white;">
            `;
            document.getElementById('modal-booking').classList.remove('hidden');
        }

        function confirmAddToCart() {
            const desc = document.getElementById('book-desc').value || "1 unit";
            const total = parseInt(document.getElementById('book-total').value) || window.currentProduct.price;
            cart.push({
                id: window.currentProduct.id,
                cat: window.currentProduct.cat,
                name: window.currentProduct.name,
                desc: desc,
                price: window.currentProduct.price,
                total: total
            });
            updateCartUI();
        }

        function addToCartDirect(name, price) {
            cart.push({name: name, desc: "1 unit (Catalog)", price: parseInt(price), total: parseInt(price)});
            updateCartUI(); 
            alert("Added to Quote!");
        }

        function updateCartUI() { 
            document.getElementById('cart-count').innerText = cart.length; 
            document.getElementById('modal-booking').classList.add('hidden'); 
        }

        function openCart() {
            if(cart.length === 0) {
                alert("Your cart is empty!");
                return;
            }
            document.getElementById('modal-cart').classList.remove('hidden'); 
            document.getElementById('cart-step').classList.remove('hidden'); 
            document.getElementById('bill-step').classList.add('hidden');
            document.getElementById('cart-items').innerHTML = cart.map((i,idx) => `
                <div style="border-bottom:1px solid #333; padding:10px; display:flex; justify-content:space-between;">
                    <div>${i.name}<br><small>${i.desc}</small></div>
                    <div style="text-align:right;">‚Çπ${i.total.toLocaleString('en-IN')} 
                        <i class="fas fa-trash" style="color:red; cursor:pointer; margin-left:10px;" onclick="cart.splice(${idx},1); openCart();"></i>
                    </div>
                </div>
            `).join('');
        }

        function generateBill() {
            const phone = document.getElementById('bill-phone').value;
            const email = document.getElementById('bill-email').value;
            if(!phone || phone.length < 10) return alert("Enter valid 10-digit Contact");
            if(!email || !email.includes('@')) return alert("Enter valid Email");
            if(!selectedBookingDate) return alert("Please select an event date first!");
            
            document.getElementById('cart-step').classList.add('hidden'); 
            document.getElementById('bill-step').classList.remove('hidden');
            document.getElementById('bill-date').innerText = new Date().toLocaleDateString(); 
            document.getElementById('bill-booking-date').innerText = selectedBookingDate;
            document.getElementById('bill-user').innerText = currentUser; 
            document.getElementById('bill-phone-display').innerText = phone; 
            document.getElementById('bill-email-display').innerText = email;
            
            let totalAmount = 0;
            document.getElementById('bill-body').innerHTML = cart.map(i => { 
                totalAmount += i.total; 
                return `<tr><td>${i.name} <br> <small>${i.desc}</small></td><td style="text-align:right;">‚Çπ${i.total.toLocaleString('en-IN')}</td></tr>`; 
            }).join('');
            document.getElementById('bill-total').innerText = totalAmount.toLocaleString('en-IN');
        }

       async function sendOrder() {
    // Clean the total amount to be a pure integer
    const total = parseInt(document.getElementById('bill-total').innerText.replace(/[^0-9]/g, '')) || 0;
    const phone = document.getElementById('bill-phone-display').innerText;
    const email = document.getElementById('bill-email-display').innerText;
    
    const orderData = { 
        id: Date.now(), 
        user: `${currentUser} (${phone})`, 
        userEmail: email, 
        date: new Date().toLocaleDateString(), 
        booking_date: selectedBookingDate,
        items: cart, 
        total: total 
    };
    
    try {
        const response = await fetch(API_URL + '/orders', { 
            method: 'POST', 
            headers: { 'Content-Type': 'application/json' }, 
            body: JSON.stringify(orderData)
        });

        if (response.ok) {
            alert("Success! Quote Request Sent to Admin.");
            cart = []; 
            updateCartUI(); 
            document.getElementById('modal-cart').classList.add('hidden');
            selectedBookingDate = "";
            document.getElementById('booking-date').value = "";
            document.getElementById('availability-msg').classList.add('hidden');
            // Refresh history if the user is looking at it
            if(!document.getElementById('view-history').classList.contains('hidden')) loadHistory();
        } else {
            alert("Failed to send quotation. Please try again.");
        }
    } catch (error) {
        console.error("Order Error:", error);
        alert("Connection error. Is the server running?");
    }
}

        async function loadHistory() { 
            try { 
                const res = await fetch(`${API_URL}/user/orders?email=${currentUserEmail}`); 
                const orders = await res.json(); 
                document.getElementById('history-table-body').innerHTML = orders.map(o => `
                    <tr>
                        <td>#${o.id}</td>
                        <td>${o.date}</td>
                        <td>${o.booking_date || 'N/A'}</td>
                        <td>${o.items.length} items</td>
                        <td style="text-align:right;">‚Çπ${o.total.toLocaleString('en-IN')}</td>
                        <td><span style="background:#3b82f6; padding:2px 6px; border-radius:4px; font-size:0.8rem;">Quote Pending</span></td>
                    </tr>
                `).join(''); 
            } catch(e) {} 
        }
        
        async function submitTicket() {
            const subject = document.getElementById('ticket-subject').value;
            const desc = document.getElementById('ticket-desc').value;
            if(!currentUser) return alert("Please login first");
            if(!subject || !desc) return alert("Please fill all fields");
            const newTicket = { id: Date.now(), user: currentUser, email: currentUserEmail, subject: subject, desc: desc, date: new Date().toLocaleDateString() };
            try {
                await fetch(API_URL + '/tickets', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(newTicket) });
                alert("Ticket Submitted Successfully!");
                document.getElementById('ticket-subject').value = ""; 
                document.getElementById('ticket-desc').value = ""; 
                goHome();
            } catch(e) { alert("Error submitting ticket."); }
        }

        // GSAP Card Swap
        const swapData = [
            { title: "PREMIUM DJ SETS", desc: "Top-tier consoles for pros", tag: "Hot" },
            { title: "JBL SOUND SYSTEM", desc: "Crystal clear audio for events", tag: "New" },
            { title: "LIVE BAND GEAR", desc: "Full kit drum sets & mics", tag: "Sale" },
            { title: "STUDIO RECORDING", desc: "Professional mixing services", tag: "Pro" }
        ];

        function initCardSwap() {
            const container = document.getElementById('swap-container');
            if(!container) return;
            container.innerHTML = '';

            swapData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = 'swap-card';
                card.style.zIndex = swapData.length - index; 
                card.innerHTML = `
                    <span class="highlight-tag">${item.tag}</span>
                    <h3>${item.title}</h3>
                    <p>${item.desc}</p>
                `;
                container.appendChild(card);
            });

            const cards = document.querySelectorAll('.swap-card');
            const cardDistance = 15;
            const scaleStep = 0.05;

            gsap.set(cards, {
                y: (i) => i * -cardDistance,
                scale: (i) => 1 - (i * scaleStep),
                zIndex: (i) => swapData.length - i
            });

            let activeIndex = 0;
            setInterval(() => {
                const topCard = cards[activeIndex];
                const otherCards = Array.from(cards).filter((_, i) => i !== activeIndex);

                gsap.to(topCard, {
                    y: 100,
                    opacity: 0,
                    duration: 0.5,
                    onComplete: () => {
                        gsap.set(topCard, { 
                            y: (swapData.length - 1) * -cardDistance, 
                            scale: 1 - ((swapData.length - 1) * scaleStep), 
                            opacity: 1,
                            zIndex: 0 
                        });
                        
                        otherCards.forEach((c, i) => {
                            const newVisualIndex = i; 
                            gsap.to(c, {
                                y: newVisualIndex * -cardDistance,
                                scale: 1 - (newVisualIndex * scaleStep),
                                zIndex: swapData.length - newVisualIndex,
                                duration: 0.5,
                                ease: "power2.out"
                            });
                        });
                    }
                });

                activeIndex = (activeIndex + 1) % swapData.length;
            }, 3000);
        }

        function changeFlowImage(url) {
            const bg = document.getElementById('flowing-bg');
            if (bg) bg.style.backgroundImage = `url('${url}')`;
        }

        // NEW: Gallery Media Player
        function playGalleryMedia(url) {
            document.getElementById('media-frame').src = url;
            document.getElementById('modal-media').classList.remove('hidden');
        }

        function closeMediaPlayer() {
            document.getElementById('media-frame').src = '';
            document.getElementById('modal-media').classList.add('hidden');
        }

        // FEATURE 1: Availability Check Functions
        async function checkAvailability() {
            const dateInput = document.getElementById('booking-date');
            const date = dateInput.value;
            const msgEl = document.getElementById('availability-msg');
            
            if (!date) {
                msgEl.classList.add('hidden');
                return;
            }
            
            selectedBookingDate = date;
            
            if (!currentCategory) {
                msgEl.classList.remove('hidden');
                msgEl.className = 'availability-status warning';
                msgEl.innerHTML = '<i class="fas fa-info-circle"></i> Please select a service category first';
                return;
            }
            
            await fetchAvailableProducts(currentCategory);
        }
        
        async function fetchAvailableProducts(cat) {
            if (!selectedBookingDate) return;
            
            const msgEl = document.getElementById('availability-msg');
            msgEl.classList.remove('hidden');
            msgEl.className = 'availability-status';
            msgEl.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking availability...';
            
            try {
                const res = await fetch(`${API_URL}/available-products?date=${selectedBookingDate}`);
                const data = await res.json();
                
                if (data.success) {
                    const availableForCategory = data.products.filter(p => p.cat === cat);
                    
                    if (data.booked_count === 0) {
                        msgEl.className = 'availability-status success';
                        msgEl.innerHTML = `<i class="fas fa-check-circle"></i> All items available for ${selectedBookingDate}`;
                    } else if (availableForCategory.length > 0) {
                        msgEl.className = 'availability-status warning';
                        msgEl.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${data.booked_count} item(s) already booked. Showing available items only.`;
                    } else {
                        msgEl.className = 'availability-status warning';
                        msgEl.innerHTML = `<i class="fas fa-times-circle"></i> All items in this category are booked for ${selectedBookingDate}`;
                    }
                    
                    // Render available products
                    document.getElementById('grid-products').innerHTML = "";
                    availableForCategory.forEach(p => {
                        const card = document.createElement('div');
                        card.className = 'product-card';
                        const img = p.image ? `<img class="product-img" src="${BASE_URL}/uploads/${p.image}">` : `<div style="width:100%; height:180px; background:linear-gradient(135deg, #1e293b, #0f172a); display:flex; align-items:center; justify-content:center; border-radius:8px; margin-bottom:15px; border:1px solid rgba(255,255,255,0.1);"><i class="${p.icon}" style="font-size:3rem; color:var(--accent-gold);"></i></div>`;
                        
                        const sampleBtn = p.sample_url ? `<a href="${p.sample_url}" target="_blank" class="sample-media-btn" onclick="event.stopPropagation();"><i class="fas fa-play"></i> Listen to Sample</a>` : '';
                        
                        card.innerHTML = `${img}<h3 style="margin-bottom:10px; font-size:1.1rem;">${p.name}</h3><p style="color:var(--accent-gold); font-weight:700; font-size:1.3rem; margin-bottom:15px;">‚Çπ${p.price.toLocaleString('en-IN')}</p>${sampleBtn}<button class="btn btn-gold" onclick="openBooking(${p.id}, '${p.name}', ${p.price}, '${p.cat}')"><i class="fas fa-cart-plus"></i> Add Quote</button>`;
                        document.getElementById('grid-products').appendChild(card);
                    });
                }
            } catch (e) {
                msgEl.className = 'availability-status warning';
                msgEl.innerHTML = '<i class="fas fa-exclamation-triangle"></i> Error checking availability';
                console.error('Availability check error:', e);
            }
        }

    </script>
</body>
</html>